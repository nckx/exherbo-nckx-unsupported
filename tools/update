#!/bin/bash -e
cd "${0%/*}"/../packages

##
## Remove dangling directories
##
rmdir */* 2>/dev/null || :
rmdir * 2>/dev/null || :

##
## Re-generate category list
##
file=../metadata/categories.conf
touch $file
for i in */; do
	echo ${i%/}
done > $file.new
msg="$( echo $( diff $file{,.new} -d -U 0 | grep '^[+-][^+-]' ) )"
mv $file{.new,}

##
## Re-generate blanket repository mask
##
cat > ../metadata/repository_mask.conf << EOF
# Automatically generated by tools/update, do not edit
( $( echo */* ) )
[[
    *token = unsupported
    *description = [ DO NOT CONTACT ME WHEN ANYTHING GOES WRONG ]
    *author = [ nckx ]
]]
EOF
